# Рефакторинг order_processing.py

## Обнаруженные проблемы качества

1. **Длинная функция**: Функция `process_checkout` содержала слишком много ответственностей (парсинг, валидация, расчёты).
2. **Магические числа**: В коде были разбросаны числовые значения без пояснений.
3. **Низкая читаемость**: Логика была перемешана, сложно было понять последовательность операций.
4. **Плохая поддерживаемость**: Изменение логики скидок требовало изменения основной функции.

## Применённые рефакторинги

1. **Выделение функций**: Логика разбита на отдельные функции:
   - `parse_request()` - разбор входных данных
   - `validate_request()` - валидация всех входных параметров
   - `calculate_subtotal()` - расчёт промежуточной суммы
   - `calculate_discount()` - расчёт скидки по купону
   - `calculate_tax()` - расчёт налога

2. **Вынос констант**: Все магические числа вынесены в константы:
   - `DEFAULT_CURRENCY = "USD"`
   - `TAX_RATE = 0.21`
   - Константы для купонов и скидок
   - Пороговые значения для скидок

3. **Улучшение читаемости**: 
   - Функция `process_checkout` теперь читается как последовательный сценарий
   - Имена функций отражают их назначение

4. **Улучшение поддерживаемости**:
   - Добавление новых купонов требует изменения только `calculate_discount()`
   - Изменение налоговой ставки требует изменения только константы
   - Валидация вынесена в отдельную функцию

## Результаты рефакторинга

### Что стало проще читать:
- Основная функция `process_checkout` сократилась
- Логика стала линейной и предсказуемой
- Каждый шаг обработки заказа чётко отделён

### Что стало проще менять:
1. **Добавление нового купона** - нужно только добавить условие в `calculate_discount()`
2. **Изменение налоговой ставки** - меняется одна константа `TAX_RATE`
3. **Изменение логики валидации** - правки только в `validate_request()`
4. **Изменение порогов скидок** - правки только в константах

